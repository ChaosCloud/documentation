<!DOCTYPE HTML>
<html lang="en-US" manifest="../manifest.appcache">
    <head prefix="og: http://ogp.me/ns# book: http://ogp.me/ns/book#">
        
        <meta charset="UTF-8">
        <title>Go Agent | Go Developer Documentation</title>

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="robots" content="index, follow">
        <meta name="author" content="GoCD">
        <meta name="description" content="Documentation describing the development environment, technology stack and architecture of Go.">
        <meta name="keywords" content="gitbook,github" >
        <meta name="generator" content="www.gitbook.io">

        
        <link rel="next" href="../4/4.4.html" />
        
        
        <link rel="prev" href="../4/4.2.html#go-server" />
        

        <meta property="og:title" content="Go Agent | Go Developer Documentation">
        <meta property="og:site_name" content="Go Developer Documentation">
        <meta property="og:type" content="book">
        <meta property="og:locale" content="en_US">

        <meta property="book:author" content="https://github.com/GoCD">
        <meta property="book:tag" content="GitBook">

        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">

        <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">
        
    </head>
    <body>
        

        <link rel="stylesheet" href="../gitbook/style.css">
        


        
    <div class="book" data-github="GoCD/documentation" data-level="4.3" data-basepath=".." data-revision="1399971823399">
    <div class="book-header">
    <!-- Actions Left -->
    
    <a href="http://go.cd" target="_blank" class="btn pull-left"><i class="fa fa-bookmark-o"></i></a>
    
    <a href="#" class="btn pull-left toggle-summary"><i class="fa fa-align-justify"></i></a>
    <a href="#" class="btn pull-left toggle-search"><i class="fa fa-search"></i></a>
    <span id="font-settings-wrapper">
        <a href="#" class="btn pull-left toggle-font-settings"><i class="fa fa-font"></i>
        </a>
        <div class="dropdown-menu font-settings">
	<div class="dropdown-caret">
  <span class="caret-outer"></span>
  <span class="caret-inner"></span>
</div>

	<div class="btn-group btn-block">
		<button id="reduce-font-size" class="btn btn-default">A</button>
		<button id="enlarge-font-size" class="btn btn-default">A</button>
	</div>

	<ul class="list-group font-family-list">
		<li class="list-group-item" data-font="0">Serif</li>
		<li class="list-group-item" data-font="1">Sans</li>
	</ul>

	<div class="btn-group btn-group-xs btn-block color-theme-list">
	  <button type="button" class="btn btn-default" id="color-theme-preview-0" data-theme="0">White</button>
	  <button type="button" class="btn btn-default" id="color-theme-preview-1" data-theme="1">Sepia</button>
	  <button type="button" class="btn btn-default" id="color-theme-preview-2" data-theme="2">Night</button>
	</div>
</div>

    </span>

    <!-- Actions Right -->
    
    <a href="#" target="_blank" class="btn pull-right" data-sharing="google-plus"><i class="fa fa-google-plus"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right" data-sharing="facebook"><i class="fa fa-facebook"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right" data-sharing="twitter"><i class="fa fa-twitter"></i></a>
    

    
    <a href="https://github.com/GoCD/documentation/stargazers" target="_blank" class="btn pull-right count-star hidden-xs"><i class="fa fa-star-o"></i> Star (<span>-</span>)</a>
    <a href="https://github.com/GoCD/documentation/watchers" target="_blank" class="btn pull-right count-watch hidden-xs"><i class="fa fa-eye"></i> Watch (<span>-</span>)</a>
    

    <!-- Title -->
    <h1>
        <i class="fa fa-spinner fa-spin"></i>
        <a href="../" >Go Developer Documentation</a>
    </h1>
</div>

    <div class="book-summary">
    <div class="book-search">
        <input type="text" placeholder="Search" class="form-control" />
    </div>
    <ul class="summary">
        
        <li>
            <a href="https://github.com/gocd/documentation/" target="blank">About the author</a>
        </li>
        

        
        <li>
            <a href="https://github.com/gocd/documentation/issues" target="blank">Questions and Issues</a>
        </li>
        

        
        <li>
            <a href="https://github.com/gocd/documentation/" target="blank">Edit and Contribute</a>
        </li>
        

        
        <li class="divider"></li>
        

        <li data-level="0" data-path="index.html">
            <a href="../"><i class="fa fa-check"></i> Introduction</a>
        </li>
        
            <li  data-level="1" >
                
                <span><b>1.</b> Concepts in Go</span>
                
                
                <ul class="articles">
                    
                        <li  data-level="1.1" data-path="1/1.1.html">
                            
                            <a href="../1/1.1.html">
                                <i class="fa fa-check"></i> <b>1.1.</b> Domain
                            </a>
                            
                        </li>
                    
                        <li  data-level="1.2" >
                            
                            <span><b>1.2.</b> Implementation</span>
                            
                        </li>
                    
                </ul>
                
            </li>
        
            <li  data-level="2" >
                
                <span><b>2.</b> Getting Started</span>
                
                
                <ul class="articles">
                    
                        <li  data-level="2.1" data-path="2/2.1.html">
                            
                            <a href="../2/2.1.html">
                                <i class="fa fa-check"></i> <b>2.1.</b> Setting up your development environment
                            </a>
                            
                        </li>
                    
                        <li  data-level="2.2" data-path="2/2.2.html">
                            
                            <a href="../2/2.2.html">
                                <i class="fa fa-check"></i> <b>2.2.</b> How to go about making changes to the codebase
                            </a>
                            
                        </li>
                    
                        <li  data-level="2.3" data-path="2/2.3.html">
                            
                            <a href="../2/2.3.html">
                                <i class="fa fa-check"></i> <b>2.3.</b> How to add a configuration migration
                            </a>
                            
                        </li>
                    
                        <li  data-level="2.4" data-path="2/2.4.html">
                            
                            <a href="../2/2.4.html">
                                <i class="fa fa-check"></i> <b>2.4.</b> How to add a database migration
                            </a>
                            
                        </li>
                    
                </ul>
                
            </li>
        
            <li  data-level="3" >
                
                <span><b>3.</b> Technology Stack</span>
                
                
                <ul class="articles">
                    
                        <li  data-level="3.1" >
                            
                            <span><b>3.1.</b> Plugins Architecture - OSGi</span>
                            
                        </li>
                    
                        <li  data-level="3.2" data-path="3/3.2.html">
                            
                            <a href="../3/3.2.html">
                                <i class="fa fa-check"></i> <b>3.2.</b> Object Relation Mapping (ORM) - Hibernate &amp; IBatis
                            </a>
                            
                        </li>
                    
                        <li  data-level="3.3" >
                            
                            <span><b>3.3.</b> Caching - EhCache</span>
                            
                        </li>
                    
                        <li  data-level="3.4" data-path="3/3.4.html">
                            
                            <a href="../3/3.4.html">
                                <i class="fa fa-check"></i> <b>3.4.</b> Dependency Injection (DI) - Spring
                            </a>
                            
                        </li>
                    
                        <li  data-level="3.5" >
                            
                            <span><b>3.5.</b> Model View Controller (MVC)</span>
                            
                        </li>
                    
                        <li  data-level="3.6" data-path="3/3.6.html">
                            
                            <a href="../3/3.6.html">
                                <i class="fa fa-check"></i> <b>3.6.</b> User Interface (UI) - jQuery &amp; Prototype, SCSS, HTML
                            </a>
                            
                        </li>
                    
                        <li  data-level="3.7" >
                            
                            <span><b>3.7.</b> Build Tool - Buildr</span>
                            
                        </li>
                    
                </ul>
                
            </li>
        
            <li  data-level="4" >
                
                <span><b>4.</b> Architecture of Go</span>
                
                
                <ul class="articles">
                    
                        <li  data-level="4.1" >
                            
                            <span><b>4.1.</b> [Overview](4/4.1.md#overview</span>
                            
                        </li>
                    
                        <li  data-level="4.2" data-path="4/4.2.html#go-server">
                            
                            <a href="../4/4.2.html#go-server">
                                <i class="fa fa-check"></i> <b>4.2.</b> Go Server
                            </a>
                            
                        </li>
                    
                        <li  data-level="4.3" data-path="4/4.3.html">
                            
                            <a href="../4/4.3.html">
                                <i class="fa fa-check"></i> <b>4.3.</b> Go Agent
                            </a>
                            
                        </li>
                    
                        <li  data-level="4.4" data-path="4/4.4.html">
                            
                            <a href="../4/4.4.html">
                                <i class="fa fa-check"></i> <b>4.4.</b> Common
                            </a>
                            
                        </li>
                    
                        <li  data-level="4.5" data-path="4/4.5.html">
                            
                            <a href="../4/4.5.html">
                                <i class="fa fa-check"></i> <b>4.5.</b> Build Infrastructure
                            </a>
                            
                        </li>
                    
                </ul>
                
            </li>
        
            <li  data-level="5" >
                
                <span><b>5.</b> Features</span>
                
                
                <ul class="articles">
                    
                        <li  data-level="5.1" data-path="5/5.1.html">
                            
                            <a href="../5/5.1.html">
                                <i class="fa fa-check"></i> <b>5.1.</b> Dashboard
                            </a>
                            
                        </li>
                    
                        <li  data-level="5.2" data-path="5/5.2.html">
                            
                            <a href="../5/5.2.html">
                                <i class="fa fa-check"></i> <b>5.2.</b> Fan-in
                            </a>
                            
                        </li>
                    
                        <li  data-level="5.3" data-path="5/5.3.html">
                            
                            <a href="../5/5.3.html">
                                <i class="fa fa-check"></i> <b>5.3.</b> Value Stream Map
                            </a>
                            
                        </li>
                    
                        <li  data-level="5.4" data-path="5/5.4.html">
                            
                            <a href="../5/5.4.html">
                                <i class="fa fa-check"></i> <b>5.4.</b> Compare Pipeline
                            </a>
                            
                        </li>
                    
                        <li  data-level="5.5" data-path="5/5.5.html">
                            
                            <a href="../5/5.5.html">
                                <i class="fa fa-check"></i> <b>5.5.</b> PackageRepository
                            </a>
                            
                        </li>
                    
                        <li  data-level="5.6" >
                            
                            <span><b>5.6.</b> Command Repository</span>
                            
                        </li>
                    
                        <li  data-level="5.7" data-path="5/5.7.html">
                            
                            <a href="../5/5.7.html">
                                <i class="fa fa-check"></i> <b>5.7.</b> Environments
                            </a>
                            
                        </li>
                    
                        <li  data-level="5.8" >
                            
                            <span><b>5.8.</b> Templates</span>
                            
                        </li>
                    
                        <li  data-level="5.9" >
                            
                            <span><b>5.9.</b> Shine</span>
                            
                        </li>
                    
                        <li  data-level="5.10" data-path="5/5.10.html">
                            
                            <a href="../5/5.10.html">
                                <i class="fa fa-check"></i> <b>5.10.</b> OAuth Gadgets
                            </a>
                            
                        </li>
                    
                        <li  data-level="5.11" data-path="5/5.11.html">
                            
                            <a href="../5/5.11.html">
                                <i class="fa fa-check"></i> <b>5.11.</b> Backup
                            </a>
                            
                        </li>
                    
                </ul>
                
            </li>
        
            <li  data-level="6" >
                
                <span><b>6.</b> CD in practice</span>
                
                
                <ul class="articles">
                    
                        <li  data-level="6.1" >
                            
                            <span><b>6.1.</b> Build Go Using Go</span>
                            
                        </li>
                    
                        <li  data-level="6.2" data-path="6/6.2.html">
                            
                            <a href="../6/6.2.html">
                                <i class="fa fa-check"></i> <b>6.2.</b> Test Infrastructure
                            </a>
                            
                        </li>
                    
                        <li  data-level="6.3" >
                            
                            <span><b>6.3.</b> Continuous Deployment</span>
                            
                        </li>
                    
                </ul>
                
            </li>
        
            <li  data-level="7" >
                
                <span><b>7.</b> Miscellaneous</span>
                
                
                <ul class="articles">
                    
                        <li  data-level="7.1" data-path="7/7.1.html">
                            
                            <a href="../7/7.1.html">
                                <i class="fa fa-check"></i> <b>7.1.</b> Technical Debt
                            </a>
                            
                        </li>
                    
                </ul>
                
            </li>
        

        
        <li class="divider"></li>
        <li>
            <a href="http://www.gitbook.io/" target="blank">Generated using GitBook</a>
        </li>
        
    </ul>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="page-wrapper" tabindex="-1">
                <div class="book-progress">
    <div class="bar">
        <div class="inner" style="width: 45.45454545454545%;min-width: 40.90909090909091%;"></div>
    </div>
    <div class="chapters">
    
        <a href="../index.html" title="Introduction" class="chapter done new-chapter" data-progress="0" style="left: 0%;"></a>
    
        <a href="../1/1.1.html" title="Domain" class="chapter done " data-progress="1.1" style="left: 4.545454545454546%;"></a>
    
        <a href="../2/2.1.html" title="Setting up your development environment" class="chapter done " data-progress="2.1" style="left: 9.090909090909092%;"></a>
    
        <a href="../2/2.2.html" title="How to go about making changes to the codebase" class="chapter done " data-progress="2.2" style="left: 13.636363636363637%;"></a>
    
        <a href="../2/2.3.html" title="How to add a configuration migration" class="chapter done " data-progress="2.3" style="left: 18.181818181818183%;"></a>
    
        <a href="../2/2.4.html" title="How to add a database migration" class="chapter done " data-progress="2.4" style="left: 22.727272727272727%;"></a>
    
        <a href="../3/3.2.html" title="Object Relation Mapping (ORM) - Hibernate &amp; IBatis" class="chapter done " data-progress="3.2" style="left: 27.272727272727273%;"></a>
    
        <a href="../3/3.4.html" title="Dependency Injection (DI) - Spring" class="chapter done " data-progress="3.4" style="left: 31.818181818181817%;"></a>
    
        <a href="../3/3.6.html" title="User Interface (UI) - jQuery &amp; Prototype, SCSS, HTML" class="chapter done " data-progress="3.6" style="left: 36.36363636363637%;"></a>
    
        <a href="../4/4.2.html#go-server" title="Go Server" class="chapter done " data-progress="4.2" style="left: 40.90909090909091%;"></a>
    
        <a href="../4/4.3.html" title="Go Agent" class="chapter done " data-progress="4.3" style="left: 45.45454545454545%;"></a>
    
        <a href="../4/4.4.html" title="Common" class="chapter  " data-progress="4.4" style="left: 50%;"></a>
    
        <a href="../4/4.5.html" title="Build Infrastructure" class="chapter  " data-progress="4.5" style="left: 54.54545454545455%;"></a>
    
        <a href="../5/5.1.html" title="Dashboard" class="chapter  " data-progress="5.1" style="left: 59.09090909090909%;"></a>
    
        <a href="../5/5.10.html" title="OAuth Gadgets" class="chapter  " data-progress="5.10" style="left: 63.63636363636363%;"></a>
    
        <a href="../5/5.11.html" title="Backup" class="chapter  " data-progress="5.11" style="left: 68.18181818181819%;"></a>
    
        <a href="../5/5.2.html" title="Fan-in" class="chapter  " data-progress="5.2" style="left: 72.72727272727273%;"></a>
    
        <a href="../5/5.3.html" title="Value Stream Map" class="chapter  " data-progress="5.3" style="left: 77.27272727272727%;"></a>
    
        <a href="../5/5.4.html" title="Compare Pipeline" class="chapter  " data-progress="5.4" style="left: 81.81818181818181%;"></a>
    
        <a href="../5/5.5.html" title="PackageRepository" class="chapter  " data-progress="5.5" style="left: 86.36363636363636%;"></a>
    
        <a href="../5/5.7.html" title="Environments" class="chapter  " data-progress="5.7" style="left: 90.9090909090909%;"></a>
    
        <a href="../6/6.2.html" title="Test Infrastructure" class="chapter  " data-progress="6.2" style="left: 95.45454545454545%;"></a>
    
        <a href="../7/7.1.html" title="Technical Debt" class="chapter  " data-progress="7.1" style="left: 100%;"></a>
    
    </div>
</div>

                <div class="page-inner">
                
                    <section class="normal" id="section-gitbook_9">
                    
                        <h1 id="4-3-go-agent">4.3 Go Agent</h1>
<h2 id="-a-name-agent-overview-a-4-3-1-overview"><a name="agent-overview"></a>4.3.1 Overview</h2>
<p>Go Agent is the component of Go which runs the jobs given to it by the Go Server. An Agent comprises of 3 parts, the Agent Bootstrapper, the Agent Launcher and the Agent itself.</p>
<p><img src="images/agent_overview.png" alt="Agent Overview"></p>
<h2 id="-a-name-agent-bootstrapper-a-4-3-2-bootstrapper"><a name="agent-bootstrapper"></a>4.3.2 Bootstrapper</h2>
<p>The bootstrapper is the only component of a Go agent that requires a manual upgrade, therefore its code is kept to a bare minimum to avoid this manual upgrade.</p>
<p>A new installation of an agent has only the agent-bootstrapper.jar. When you start an agent, it essentially starts the agent-bootstrapper.jar, which does the following: </p>
<ol>
<li>Facilitate the automatic upgrade of the agent-launcher.</li>
<li>Launches the agent-launcher.</li>
<li>If at any point the launcher process is killed, the bootstrapper re-launches it as long as the boostrapper process is still running.</li>
</ol>
<p><strong>How does the bootstrapper facilitate automatic upgrade of the launcher and launch it?</strong></p>
<p>The agent-launcher.jar is packaged inside the agent-bootstrapper.jar. When the bootstrapper starts, it starts the launcher by doing the following:</p>
<ol>
<li>Creates a temporary launcher jar, with the format [UUID]agent-launcher.jar, by copying over the agent-launcher.jar.</li>
<li>Reads the values of specific keys from <code>MANIFEST.MF</code> of the agent-launcher.jar. This is done to determine which class needs to be launched from the Launcher.</li>
<li>Gets the <code>AgentLauncher</code> class.</li>
<li>Launches the launcher by calling the launch method on the <code>AgentLauncher</code> class.</li>
</ol>
<p>This agent is launched this way inorder to prevent the launcher from being launched as a separate java process while still maintaining it as a component on its own.</p>
<p>The bootstrapper logs to go-agent-bootstrapper.log file.</p>
<h2 id="-a-name-agent-launcher-a-4-3-3-launcher"><a name="agent-launcher"></a>4.3.3 Launcher</h2>
<p>Once the launcher is launched, it does the following:</p>
<ol>
<li>Creates a lockfile. The purpose of the lockfile is to prevent multiple instances of the bootstrapper from being launched using the same agent-bootstrapper.jar, i.e., if you want to run two agents on the same box, they should not be started in the same location as it would interfere with the working of the agents. </li>
<li>Checks to see if a new version of the agent-launcher.jar is available. This is done by comparing the <code>md5</code> checksum of the agent-launcher.jar present locally with the agent-launcher.jar on the Go Server. If the launcher is upgrades itself, it returns and it is then restarted by the bootstrapper.</li>
<li>Downloads the agent.jar from the Go server if required. It then starts the agent by determining the starting point of the agent, <code>AgentProcessParentImpl</code>, by reading specific keys from <code>MANIFEST.MF</code> of the agent.jar and starting it.</li>
</ol>
<p>The launcher allows for the automatic upgradation of the agent without manual intervention.</p>
<p>The agent launcher logs to the go-agent-launcher.log file.</p>
<h2 id="-a-name-agent-a-4-3-4-agent"><a name="agent"></a>4.3.4 Agent</h2>
<p>The agent is responsible for running a job given to it by the server.</p>
<p>The starting point for an agent is the <code>AgentProcessParentImpl</code>. At this point three things happen, agent is downloaded if required (this is done twice - once in the launcher and once at this point, this is to maintain backward compatibility with agents prior to version 2.3, where the launcher module was not present), plugins are downloaded if required, and the agent.jar is launched as a separate java process.</p>
<p>Agents are uniquely identified by the server based on their UUID. Information about all agent instances are stored in-memory on the go server.</p>
<p>At any given time, an agent has to be in one of the following states:</p>
<ol>
<li>Pending - until an adminitrator enables it for the very first time and that&#39;s how agent details come into the config.</li>
<li>Idle - when it is not running any jobs.</li>
<li>Preparing - when it is preparing to run the job given to it by the server, for example - checking out the source code.</li>
<li>Building - when it is running the job given to it by the server.</li>
<li>Lost Contact - if it does not ping the server for more than 5 minutes.</li>
<li>Missing - if the agent is restarted when an agent is in the lost contact state.</li>
<li>Disabled - when an agent is disabled manually by an administrator.</li>
</ol>
<p>An agent has 3 threads running as part of it:</p>
<ol>
<li>Ping Thread - runs every 5 seconds, to inform the server that the agent is alive. It also informs the server of the agents runtime information. </li>
<li>Loop/Worker Thread - The first time an agent comes up, the loop thread, which runs every 10 seconds, registers it with the server. Once this is done, it checks for agent upgrade and also retrieves work from the server.</li>
<li>Instruction Execution Thread - which runs every 10 seconds to check if the server has issued a job cancel instruction. A separate thread is maintained as a job cancel instruction is an asynchronous action, it might occur at any time and hence, it has to be monitored constantly.</li>
</ol>
<h3 id="4-3-4-1-upgrade">4.3.4.1 Upgrade</h3>
<p>In most situations, the Go agent services keep running while the server is upgraded. The loop thread checks to see if the agent needs to be upgraded every time it runs. So, the first time the loop thread contacts the server after a server upgrade, it realizes that the agent needs to be upgraded. The agent kills itself as a result of this. The agent launcher then upgrades and restarts the agent.</p>
<h3 id="4-3-4-2-initialization">4.3.4.2 Initialization</h3>
<p>Agent initialization happens through Spring. The first time the AgentController bean is initialized, it creates the following:</p>
<ol>
<li>Pipelines folder - the location where the agent will check out the source code to run the jobs on.</li>
<li>Secure Socket Layer (SSL) Infratstucture - communication infrastructure that an agent uses to communicate with the server. </li>
<li>Global Unique Identifier (GUID) - with which the agent identifies itself with the server. As part of this procces the GUID of the agent is stored in the guid.txt, present under the config folder of the agent working directory.</li>
</ol>
<p>The initial communication, up until registration, between the server and agent happens over HTTP. Once the registration is complete, the communication between the server and agent happens over HTTPS. </p>
<h3 id="4-3-4-3-registration">4.3.4.3 Registration</h3>
<p>Registration of the agent with the server happens when the loop thread is first initialized. Since, a number of agents can contact the server at the same time, the registration process might not be successful the very first time itself. So, the agent keeps trying to register itself every 10 seconds until it is successful.</p>
<p><em>Agent Side</em></p>
<pre><code>loop_thread()
    agent_registration()
    setup_ssl_infrastructure()
    retrieve_agent_cookie()
end
</code></pre><p>Registration of the agent involves setting up the following:</p>
<ol>
<li>Agent Certificate.</li>
<li>Agent Trust Store.</li>
<li>Agent Cookie.</li>
<li>SSL infratructure between the server and agent.</li>
</ol>
<p>Once the agent requests registration form the server, the server does the following:</p>
<p><em>Server Side</em></p>
<pre><code>registration_request_from_agent()
    auto_register_agent_if_required()
    allAgentInstances.registerNewAgent()
    assign_certification()
end

assign_certification()
    assign_agent_x509_certificate
    assign_agent_trust_store
end
</code></pre><p>When an agent is initially registered with the server, it is in the pending state until a Go administrator manually enables the agent. This is mainly done to prevent malicious agents from automatically enabling themselves on the server.</p>
<p><strong>Auto Registering Agents</strong></p>
<p>In the case where you want to enable an agent automatically with the server, you can do so by creating the agent-registration.properties file. Through this file you can specify which resources and environments the agent belongs to. When the agent initially tries to register itself with the server, the server checks to see if the incoming request has an agent-registration.properties file <code>auto_register_agent_if_required()</code>, if so then it sets up the agent with the resources and environments specified in this file. The agent will be in the enabled state after this.</p>
<h3 id="4-3-4-4-retrieve-build-work">4.3.4.4 Retrieve &amp; Build Work</h3>
<p>Once the agent is enabled on the server, it is by default in the &quot;idle&quot; state, indicating that the agent is not doing any work. The loop thread then requests the server for work. </p>
<p><em>Server Side</em></p>
<pre><code>getWork()
    if_agent_has_not_been_assigned_work_yet_then
        idleAgentsTopic.post(agent_idle_details)
        return_no_work
    else_if_agent_is_assigned_work
        return_work
end
</code></pre><p>A listener, i.e., the <code>WorkFinder</code>, is registered on the IdleAgentsTopic queue, so when an idle agent detail is added to this queue the following happens:</p>
<p><em>Server Side</em></p>
<pre><code>assignWork()
    buildAssignmentService.assignWork(agent_details)
</code></pre><p>Once the server assigns work to the agent, this work is picked up by the agent the next time the loop thread contacts the server, which is 10 seconds later. As such, a <code>JobPlan</code> is provided to the agent, this is a copy of the job that has been configured on the server. </p>
<p>The agent then goes into the &quot;Preparing&quot; state while it is preparing to run the job. It then goes into the &quot;Building&quot; state once it begins to run the job, which happens through <code>BuildWork</code>.</p>
<p>The agent communicates its entire transition, from being assigned a job to completing the job, constantly with the server through the <code>GoPublisher</code>. The output of the task being run is contantly updated in the go-agent.log through the <code>GoControlLog</code>, and this is the information that is available on the console log of the server for that particular task.  </p>
<p>The agent logs to the go-agent.log file.</p>

                    
                    </section>
                
                </div>
            </div>
        </div>

        
        <a href="../4/4.2.html#go-server" class="navigation navigation-prev "><i class="fa fa-angle-left"></i></a>
        
        
        <a href="../4/4.4.html" class="navigation navigation-next "><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        

        <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.1.3/ace.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.1.3/mode-javascript.js"></script>
        <script src="../gitbook/jsrepl/jsrepl.js" id="jsrepl-script"></script>
        <script src="../gitbook/app.js"></script>
        

    
    <script src="../gitbook/plugins/gitbook-plugin-mixpanel/plugin.js"></script>
    

    
    <script src="http://cdn.mathjax.org/mathjax/2.0-latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-mathjax/plugin.js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {};
    gitbook.start(config);
});
</script>

    </body>
</html>
